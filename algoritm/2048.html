<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>


<body>
<style>
    #game2048{
        background-color: grey;
        position: fixed;
        top: 30%;
        left:30%;
        width:420px;
        height:420px;
    }
    .inline {
        display: inline-block;
        background-color: aquamarine;
        width:100px;
        height:100px;
        margin: auto;
        padding: auto;
        text-align: center;
        color: black;
        font-family: 'Courier New', Courier, monospace;
        font-size: 50px;
    }
</style>

<div id="game2048">
    <!-- <div class="row">
        <div class="inline block" id="id00"></div>
        <div class="inline" id="id01"></div>
        <div class="inline" id="id02"></div>
        <div class="inline" id="id03"></div>
    </div>
    <div class="row">
        <div class="inline" id="id10"></div>
        <div class="inline" id="id11"></div>
        <div class="inline" id="id12"></div>
        <div class="inline" id="id13"></div>
    </div>
    <div class="row">
        <div class="inline" id="id20"></div>
        <div class="inline" id="id21"></div>
        <div class="inline" id="id22"></div>
        <div class="inline" id="id23"></div>
    </div>
    <div class="row">
        <div class="inline" id="id30"></div>
        <div class="inline" id="id31"></div>
        <div class="inline" id="id32"></div>
        <div class="inline" id="id33"></div>
    </div> -->
</div>

<input id="size_block" type="number" placeholder="4" min="3" max="10">
<input id="start"  type="button" value="restart">
</body>
<script>
    let start_game = document.getElementById('start');
    class Grid{
        constructor(size){
            this.size = size;
            this.table = Array(this.size).fill().map(() => Array(this.size).fill(0));
            this.empty = [];
            this.color = {
                        0:"#f0dfce",
                        2:"#fadbc0",
                        4:"#ffebcd",
                        8:"#ffc266",
                        16:"#ff9900",
                        32:"#d99184",
                        64:"#cc6d5c",
                        128:"#914834",
                        256:"#7abdff",
                        512:"#b6e1fc",
                        1024:"#ccccff",
                        2048:"#52bafa",
                        4096:"#00c0eb",
                    }

            for (let i=0;i<this.size;i++){
                let elem = document.createElement("div");
                elem.className = "row";
                elem.id = `row${i}`;
                document.getElementById("game2048").appendChild(elem);
                for (let j=0;j<this.size;j++){
                    let block = document.createElement("div");
                    block.id = `id${i}${j}`;
                    block.className = 'inline';
                    elem.appendChild(block);
                    
                }    
            }
        }


        swipe(){
            for (let i=0; i<this.size;i++){
                for (let j=this.size-1;j>0;j--){
                    if (this.table[i][j]!=0 && this.table[i][j]==this.table[i][j-1]){
                        this.table[i][j] = this.table[i][j-1]*2;
                        this.table[i][j-1] = 0;
                        break;
                    }
                }
                let cur = this.table[i].filter((x) => x!=0);
                let u = this.size-1;
                while (cur.length !== 0){
                    this.table[i][u] = cur.pop();
                    u=u-1;
                }
                while (u>-1){
                    this.table[i][u] = 0;
                    u=u-1;
                }
            }
            this.add_elem();
        }
        swipe_right(){
            this.swipe();
        }
        swipe_left(){
            this.rotate("left");
            this.swipe();
            this.rotate("down");
            this.rotate("down");
        }
        swipe_up(){
            this.rotate("down");
            this.swipe();
            this.rotate("up");
        }
        swipe_down(){
            this.rotate("up");
            this.swipe();
            this.rotate("down");
        }

        rotate(type){
            if (type=="up")
            this.table = this.table[0].map((val, index) => this.table.map(row => row[row.length-1-index]));
            if (type=="down")
            this.table = this.table[0].map((val, index) => this.table.map(row => row[index]).reverse())
            if (type=="left"){
                this.table = this.table[0].map((val, index) => this.table.map(row => row[row.length-1-index]));
                this.table = this.table[0].map((val, index) => this.table.map(row => row[row.length-1-index]));
            }

        }
        add_elem(){
            let cur = [];
            let c = 0;
            for (let i=0; i<this.size; i++){
                for (let j=0; j<this.size; j++){
                    if (this.table[i][j]===0)
                        cur.push(c);
                    c=c+1;
                }
            }
            if (cur.length!==0){
                let ind = Math.floor(Math.random() * cur.length);
                this.table[Math.floor(cur[ind]/this.size)][cur[ind]%this.size] = 2 + (2* (Math.floor(Math.random()*10)%10==0));
            }
            else
                if (this.check_lose())
                    alert("you lose")
        }

        draw(){
            for (let i =0; i<this.size;i++){
                for (let j=0; j<this.size;j++){
                    let elem = document.getElementById(`id${i}${j}`);
                    elem.style.backgroundColor = this.color[this.table[i][j]];    
                    elem.innerHTML = this.table[i][j]!==0?this.table[i][j]:"&ensp;";
                }
            }
        }
        check_lose(){
            for (let i=1; i<this.size-1; i++){
                for (let j=1; j<this.size-1; j++){
                    if  ((this.table[i][j]===this.table[i][j-1])
                     || (this.table[i][j]===this.table[i-1][j])
                     || (this.table[i][j]===this.table[i+1][j])
                     || (this.table[i][j]===this.table[i][j+1]))
                        return 0;
                }           
            }
            for (let i=0; i<this.size;i++){
                for (let j=0; j<this.size-1;j++){
                    if (i<this.size){
                        if (this.table[i][j]==this.table[i][j+1] || this.table[i][j]==[i+1][j])
                        return 0;
                    }
                    else{
                        if (this.table[i][j]==this.table[i][j+1]){
                            return 0;
                        }
                    }
                }
            }


            return 1;
        }
    }
    var a = new Grid(4);
    a.draw()
    document.addEventListener('keydown', (e) => {
        console.log(`Нажата клавиша: ${e.key}`);
        if (e.key == "ArrowLeft"){
            a.swipe_left();
        }
        if (e.key=="ArrowRight"){
            a.swipe_right();
        }
        if (e.key=="ArrowDown"){
            a.swipe_down();

        }
        if (e.key=="ArrowUp"){
            a.swipe_up();
        }
        a.draw();

    }
    );
    start_game.addEventListener('click',(e)=> {
        let r = document.getElementById('size_block').value;
        console.log(r);
        game = document.getElementById('game2048');        
        game.innerHTML='';
        a = new Grid(Number(r));
        a.draw();

    });

</script>
</html>
